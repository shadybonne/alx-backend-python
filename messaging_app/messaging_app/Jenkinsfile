# Use the official Jenkins image as the base
FROM jenkins/jenkins:lts

# Switch to the root user to install dependencies
USER root

# Install necessary packages for building and testing Python apps
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    git \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# Switch back to the jenkins user
USER jenkins

# Install plugins using a specific script from Jenkins
# The plugins are specified in the format: <plugin-id>:<version>
COPY plugins.txt /usr/share/jenkins/ref/plugins.txt
RUN /usr/local/bin/install-plugins.sh < /usr/share/jenkins/ref/plugins.txt

# Expose the default Jenkins port
EXPOSE 8080
